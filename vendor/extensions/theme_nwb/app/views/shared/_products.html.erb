<%
  paginated_products = Spree::Config.searcher.products if params.key?(:keywords)
  paginated_products ||= products
%>

<ul class="productList">
  <% products.each do |product|
    %><li class="<%= products.index(product) < 2 ? "" : "border" %>">
<% if @site.code == "pwb" %>
      <%= link_to small_image(product, {:style => "max-width:70px;"}), product, {:class => "photo"} %>
      <div class="info" style="min-height:145px;">
        <h2><%= link_to truncate(product.name, :length => 26), product, :title => product.name %></h2>
        <p class="itemNum">Item # <%= product.sku %></p>
        <p class="description"><%= product.subtitle_main %></p>
        <div class="rating">
          <div class="pr_snippet_category">
            <script type="text/javascript">
            var pr_snippet_min_reviews=1;
            POWERREVIEWS.display.snippet(document, { pr_page_id : "<%= product.legacy_id %>" });
            </script>
          </div>
        </div>
        <p class="price"><%= product_price(product) %> USD</p>
        <p class="more"><a href="#" title="Product Info &raquo;">Product Info &raquo;</a></p>
      </div>
      <div class="price">
        <% form_for :order, :url => orders_url do |f| %>
          <fieldset>
             <div class="quantity">
              <label>Quantity</label>
              <%= text_field_tag("variants[#{product.master.id}]", 1)  %>
            </div>
            <%= submit_tag("Buy Now", :class => "btnAddCart") %>
          </fieldset>
        <% end %>
      </div>
<% else %>
      <%= link_to small_image(product, {:style => "max-width:70px;"}), product, {:class => "photo"} %>
      <div class="info">
        <h2><%= link_to truncate(product.name, :length => 26), product, :title => product.name %></h2>
        <p class="itemNum">Item # <%= product.sku %></p>
        <p class="description"><%= product.subtitle_main %></p>
        <p class="more"><a href="#" title="Product Info &raquo;">Product Info &raquo;</a></p>
        <div class="rating">
          <div class="pr_snippet_category">
            <script type="text/javascript">
            var pr_snippet_min_reviews=1;
            POWERREVIEWS.display.snippet(document, { pr_page_id : "<%= product.legacy_id %>" });
            </script>
          </div>
        </div>
      </div>
      <div class="action">
        <div class="price">
          <p>Save <%= number_to_currency(product.base_price - product.master.volume_price(1)) %></p>
          <p>Price <%= number_to_currency(product.master.volume_price(1)) %></p>
        </div>
        <% form_for :order, :url => orders_url do |f| %>
          <%= hidden_field_tag("variants[#{product.master.id}]", 1)  %>
          <%= submit_tag("Buy Now", :class => "btnAddCart", :type => "image", :src => "data:image/gif;base64,R0lGODlhSAAUALMAACB+LovPk0isTzCcOHnHfyuTNP///1O2WzulRf///wAAAAAAAAAAAAAAAAAAAAAAACH5BAEHAAkALAAAAABIABQAAAT/MIFJq704682rRGAojmRpnmgaHlPhvnAsz3Rt3y8L4Hzv+7qb4UcsygiTgXLJBBiY0Kh0Sq1OkYCq08rteqVY7dNAVj6XYzR0XEaTz+dBPA5OUp2GZD7u3A78Snh6ZhRyfod0UVgoTiF9Bo55CJCQIo0gjZcIfZOdlCmLJ5qPkZt7I6OQqaaPmiahJqmrpJaVpreYqnu0J7AlsrZkm52otpnGqp0AxChYAs/Q0XhvAgACb07P2dHVBtDZ1m/e2uPb3NzO598V69bW5Ofv2u3y1d/q5+n4++rj/P8A1QWYcKCgwYMIEx50orChw4cNBwKASLHggIoYMx6QSKCjx48gE0OKHEmypEmPAyV0WMmyZcsEEQAAOw==") %>
        <% end %>
      </div>
<%end%>
    </li><% 
    if (products.index(product) % 2) == 1 && @site.code == "pwb" && (products.index(product) < (products.size-1))
      %><li class="spacer">&nbsp;</li><%
    end
  end %>
  <%(products.size % 2).times do%>
    <li class="border">&nbsp;</li>
  <%end%>
</ul>

<% if paginated_products.respond_to?(:total_pages)
      params.delete(:search)
      params.delete(:taxon)
%><%= will_paginate(paginated_products,
                    :previous_label => "&#171; #{t('previous')}",
                    :next_label => "#{t('next')} &#187;") %>
<% end -%>
